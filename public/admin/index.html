<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin Y·∫øn S√†o - Qu·∫£n l√Ω chi ti·∫øt</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    body{background:#faf7f0; font-family: 'Inter', -apple-system, sans-serif}
    .card{background:#fff;border:1px solid #e5e5e5;border-radius:16px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
    .grid{display:grid;gap:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .col{display:flex;flex-direction:column;gap:8px}
    input,textarea,select{border:1px solid #d1d5db;border-radius:8px;padding:12px;width:100%;font-size:14px}
    input:focus,textarea:focus,select:focus{outline:none;border-color:#C8A15A;box-shadow:0 0 0 3px rgba(200,161,90,0.1)}
    button{border-radius:8px;padding:12px 16px;font-weight:500;cursor:pointer;border:1px solid transparent}
    .btn{background:#C8A15A;color:#fff;border-color:#C8A15A}
    .btn:hover{background:#b8925a}
    .btn-outline{background:#fff;border:1px solid #C8A15A;color:#4B3A2B}
    .btn-outline:hover{background:#fef7ed}
    .btn-danger{background:#dc2626;color:#fff}
    .btn-danger:hover{background:#b91c1c}
    .btn-sm{padding:8px 12px;font-size:12px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{border-bottom:1px solid #f3f4f6;padding:12px 8px;text-align:left}
    th{background:#f9fafb;font-weight:600}
    .img-preview{width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid #e5e5e5}
    .status-active{background:#10b981;color:white;padding:4px 8px;border-radius:4px;font-size:12px}
    .status-inactive{background:#6b7280;color:white;padding:4px 8px;border-radius:4px;font-size:12px}
    .tab-active{background:#C8A15A;color:white}
    .form-group{margin-bottom:16px}
    .form-label{font-weight:500;margin-bottom:8px;display:block;color:#374151}
    .form-help{font-size:12px;color:#6b7280;margin-top:4px}
    .modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal.show{display:flex}
    .modal-content{background:white;border-radius:16px;padding:24px;width:90%;max-width:600px;max-height:90vh;overflow-y:auto}
    .image-gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px;margin-top:12px}
    .image-item{position:relative;border-radius:8px;overflow:hidden;border:1px solid #e5e5e5}
    .image-item img{width:100%;height:100px;object-fit:cover}
    .image-remove{position:absolute;top:4px;right:4px;background:#dc2626;color:white;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:12px}
    .drag-drop{border:2px dashed #d1d5db;border-radius:8px;padding:32px;text-align:center;background:#f9fafb;cursor:pointer}
    .drag-drop.dragover{border-color:#C8A15A;background:#fef7ed}
  </style>
</head>
<body class="p-4">
  <div id="app" class="grid max-w-6xl mx-auto"></div>
  
  <!-- Product Edit Modal -->
  <div id="productModal" class="modal">
    <div class="modal-content">
      <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:20px">
        <h2 id="modalTitle">Th√™m s·∫£n ph·∫©m m·ªõi</h2>
        <button type="button" onclick="closeModal()" style="background:none;border:none;font-size:24px;cursor:pointer">√ó</button>
      </div>
      
      <form id="productForm" class="grid">
        <input type="hidden" id="edit_id">
        
        <div class="row">
          <div class="col" style="flex:2">
            <label class="form-label">T√™n s·∫£n ph·∫©m *</label>
            <input id="edit_name" placeholder="V√≠ d·ª•: Y·∫øn ch∆∞ng h≈© 70ml" required>
            <div class="form-help">T√™n hi·ªÉn th·ªã c·ªßa s·∫£n ph·∫©m</div>
          </div>
          <div class="col" style="flex:1">
            <label class="form-label">Slug URL *</label>
            <input id="edit_slug" placeholder="yen-chung-hu-70ml" required>
            <div class="form-help">URL th√¢n thi·ªán (a-z, 0-9, d·∫•u g·∫°ch ngang)</div>
          </div>
        </div>

        <div class="row">
          <div class="col" style="flex:1">
            <label class="form-label">Gi√° b√°n (VNƒê) *</label>
            <input id="edit_price" type="number" placeholder="89000" required>
          </div>
          <div class="col" style="flex:1">
            <label class="form-label">Gi√° g·ªëc (VNƒê)</label>
            <input id="edit_original_price" type="number" placeholder="120000">
            <div class="form-help">ƒê·ªÉ hi·ªÉn th·ªã gi√° g·∫°ch ngang</div>
          </div>
          <div class="col" style="flex:1">
            <label class="form-label">Danh m·ª•c</label>
            <select id="edit_category_id">
              <option value="">-- Ch·ªçn danh m·ª•c --</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">M√¥ t·∫£ ng·∫Øn</label>
          <textarea id="edit_description" rows="3" placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ s·∫£n ph·∫©m, hi·ªÉn th·ªã tr√™n card..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">M√¥ t·∫£ chi ti·∫øt</label>
          <textarea id="edit_long_desc" rows="5" placeholder="M√¥ t·∫£ chi ti·∫øt, th√†nh ph·∫ßn, c√¥ng d·ª•ng, c√°ch s·ª≠ d·ª•ng..."></textarea>
        </div>

        <div class="row">
          <div class="col" style="flex:1">
            <label class="form-label">Tr·∫°ng th√°i</label>
            <select id="edit_status">
              <option value="active">Ho·∫°t ƒë·ªông</option>
              <option value="inactive">·∫®n</option>
              <option value="draft">Nh√°p</option>
            </select>
          </div>
          <div class="col" style="flex:1">
            <label class="form-label">S·∫Øp x·∫øp</label>
            <input id="edit_sort_order" type="number" value="0" placeholder="0">
            <div class="form-help">S·ªë nh·ªè h∆°n hi·ªÉn th·ªã tr∆∞·ªõc</div>
          </div>
          <div class="col" style="flex:1">
            <label class="form-label">T·ªìn kho</label>
            <input id="edit_stock" type="number" placeholder="100">
            <div class="form-help">ƒê·ªÉ tr·ªëng = kh√¥ng gi·ªõi h·∫°n</div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">H√¨nh ·∫£nh s·∫£n ph·∫©m</label>
          <div class="drag-drop" id="imageDrop">
            <div>K√©o th·∫£ h√¨nh ·∫£nh v√†o ƒë√¢y ho·∫∑c <strong>click ƒë·ªÉ ch·ªçn file</strong></div>
            <div style="font-size:12px;color:#6b7280;margin-top:8px">H·ªó tr·ª£: JPG, PNG, WebP. T·ªëi ƒëa 5MB m·ªói file.</div>
          </div>
          <input type="file" id="imageInput" multiple accept="image/*" style="display:none">
          <div id="imageGallery" class="image-gallery"></div>
        </div>

        <div class="row" style="justify-content:flex-end;gap:12px;margin-top:24px">
          <button type="button" onclick="closeModal()" class="btn-outline">H·ªßy</button>
          <button type="submit" class="btn">L∆∞u s·∫£n ph·∫©m</button>
        </div>
      </form>
    </div>
  </div>

<script>
const $ = (s,ctx=document)=>ctx.querySelector(s);
const $$ = (s,ctx=document)=>Array.from(ctx.querySelectorAll(s));

async function api(path, opts={}){
  const res = await fetch('/api/admin'+path, {credentials:'include', ...opts});
  if(!res.ok){ 
    const t = await res.json().catch(()=>({})); 
    throw new Error(t.error||res.statusText); 
  }
  return res.json();
}

let currentProduct = null;
let categories = [];

// Authentication
function viewLogin(){
  app.innerHTML = `
    <div class="card">
      <h2>üîê ƒêƒÉng nh·∫≠p Admin</h2>
      <div class="col">
        <input id="password" type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u admin">
        <button class="btn" id="btnLogin">ƒêƒÉng nh·∫≠p</button>
      </div>
      <p style="font-size:14px;color:#6b7280;margin-top:16px">
        M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh: <code>Calomam@12</code><br>
        (N√™n thay ƒë·ªïi b·∫±ng bi·∫øn m√¥i tr∆∞·ªùng <strong>ADMIN_PASSWORD</strong>)
      </p>
    </div>`;
  $('#btnLogin').onclick = async ()=>{
    const password = $('#password').value.trim();
    try{
      await api('/login', {method:'POST', body: new URLSearchParams({password})});
      viewDashboard();
    }catch(e){ alert('‚ùå ' + e.message); }
  };
}

// Main Dashboard
async function viewDashboard(){
  try{ await api('/me'); }catch(e){ return viewLogin(); }

  app.innerHTML = `
  <div class="grid">
    <div class="card">
      <h1>üè™ Y·∫øn S√†o Admin Dashboard</h1>
      <div class="row">
        <button class="btn tab-active" id="tabProds">üì¶ S·∫£n ph·∫©m</button>
        <button class="btn-outline" id="tabCats">üè∑Ô∏è Danh m·ª•c</button>
        <button class="btn-outline" id="tabUpload">üìÅ Upload</button>
        <button class="btn-outline" onclick="location.reload()">üîÑ Refresh</button>
      </div>
    </div>
    <div id="panel" class="grid"></div>
  </div>`;

  $('#tabProds').onclick = ()=>{switchTab('tabProds'); renderProducts();};
  $('#tabCats').onclick = ()=>{switchTab('tabCats'); renderCategories();};
  $('#tabUpload').onclick = ()=>{switchTab('tabUpload'); renderUpload();};
  
  await loadCategories();
  renderProducts();
}

function switchTab(activeId){
  $$('button[id^="tab"]').forEach(btn => {
    btn.className = btn.id === activeId ? 'btn tab-active' : 'btn-outline';
  });
}

async function loadCategories(){
  try{
    const {data} = await api('/categories');
    categories = data;
  }catch(e){
    categories = [];
  }
}

// Products Management
async function renderProducts(){
  try{
    const {data: products} = await api('/products');
    
    $('#panel').innerHTML = `
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <h3>üì¶ Qu·∫£n l√Ω s·∫£n ph·∫©m (${products.length})</h3>
          <button class="btn" onclick="openProductModal()">‚ûï Th√™m s·∫£n ph·∫©m m·ªõi</button>
        </div>
      </div>
      
      <div class="card">
        <div style="overflow-x:auto">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>H√¨nh ·∫£nh</th>
                <th>T√™n s·∫£n ph·∫©m</th>
                <th>Slug</th>
                <th>Gi√°</th>
                <th>Danh m·ª•c</th>
                <th>Tr·∫°ng th√°i</th>
                <th>T·ªìn kho</th>
                <th>Thao t√°c</th>
              </tr>
            </thead>
            <tbody id="productsTable">
              ${products.map(p => renderProductRow(p)).join('')}
            </tbody>
          </table>
        </div>
      </div>`;
  }catch(e){
    $('#panel').innerHTML = `<div class="card"><p>‚ùå L·ªói: ${e.message}</p></div>`;
  }
}

function renderProductRow(product){
  const category = categories.find(c => c.id === product.category_id);
  const firstImage = product.images && product.images[0] ? 
    `<img src="${product.images[0]}" class="img-preview" alt="${product.name}">` : 
    `<div style="width:60px;height:60px;background:#f3f4f6;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;color:#9ca3af">No image</div>`;
  
  const statusBadge = product.status === 'active' ? 
    `<span class="status-active">Ho·∫°t ƒë·ªông</span>` : 
    `<span class="status-inactive">${product.status || 'inactive'}</span>`;

  return `
    <tr>
      <td>${product.id}</td>
      <td>${firstImage}</td>
      <td><strong>${product.name}</strong><br><small style="color:#6b7280">${product.description || ''}</small></td>
      <td><code>${product.slug}</code></td>
      <td><strong>${product.price?.toLocaleString('vi-VN')}‚Ç´</strong></td>
      <td>${category ? category.name : '-'}</td>
      <td>${statusBadge}</td>
      <td>${product.stock || '‚àû'}</td>
      <td>
        <div class="row" style="gap:8px">
          <button class="btn-outline btn-sm" onclick="openProductModal(${product.id})">‚úèÔ∏è S·ª≠a</button>
          <button class="btn-danger btn-sm" onclick="deleteProduct(${product.id})">üóëÔ∏è X√≥a</button>
        </div>
      </td>
    </tr>`;
}

// Product Modal Functions
function openProductModal(productId = null){
  const modal = $('#productModal');
  const title = $('#modalTitle');
  
  if(productId){
    title.textContent = 'Ch·ªânh s·ª≠a s·∫£n ph·∫©m';
    loadProductForEdit(productId);
  } else {
    title.textContent = 'Th√™m s·∫£n ph·∫©m m·ªõi';
    resetForm();
  }
  
  populateCategories();
  setupImageHandling();
  modal.classList.add('show');
}

function closeModal(){
  $('#productModal').classList.remove('show');
  currentProduct = null;
}

async function loadProductForEdit(productId){
  try{
    const {data: products} = await api('/products');
    currentProduct = products.find(p => p.id === productId);
    
    if(currentProduct){
      $('#edit_id').value = currentProduct.id || '';
      $('#edit_name').value = currentProduct.name || '';
      $('#edit_slug').value = currentProduct.slug || '';
      $('#edit_price').value = currentProduct.price || '';
      $('#edit_original_price').value = currentProduct.original_price || '';
      $('#edit_category_id').value = currentProduct.category_id || '';
      $('#edit_description').value = currentProduct.description || '';
      $('#edit_long_desc').value = currentProduct.long_desc || '';
      $('#edit_status').value = currentProduct.status || 'active';
      $('#edit_sort_order').value = currentProduct.sort_order || 0;
      $('#edit_stock').value = currentProduct.stock || '';
      
      renderImageGallery(currentProduct.images || []);
    }
  }catch(e){
    alert('‚ùå L·ªói t·∫£i s·∫£n ph·∫©m: ' + e.message);
  }
}

function resetForm(){
  $('#productForm').reset();
  $('#edit_id').value = '';
  $('#edit_status').value = 'active';
  $('#edit_sort_order').value = '0';
  renderImageGallery([]);
}

function populateCategories(){
  const select = $('#edit_category_id');
  select.innerHTML = '<option value="">-- Ch·ªçn danh m·ª•c --</option>';
  categories.forEach(cat => {
    select.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
  });
}

// Image Handling
function setupImageHandling(){
  const dropZone = $('#imageDrop');
  const fileInput = $('#imageInput');
  
  dropZone.onclick = () => fileInput.click();
  
  dropZone.ondragover = (e) => {
    e.preventDefault();
    dropZone.classList.add('dragover');
  };
  
  dropZone.ondragleave = () => dropZone.classList.remove('dragover');
  
  dropZone.ondrop = (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    handleFiles(e.dataTransfer.files);
  };
  
  fileInput.onchange = (e) => handleFiles(e.target.files);
}

async function handleFiles(files){
  const formData = new FormData();
  for(const file of files){
    if(file.size > 5 * 1024 * 1024){
      alert(`‚ùå File ${file.name} qu√° l·ªõn (>5MB)`);
      continue;
    }
    formData.append('files', file);
  }
  
  try{
    const result = await api('/upload', {method: 'POST', body: formData});
    const currentImages = getCurrentImages();
    const newImages = [...currentImages, ...result.files.map(f => f.url)];
    renderImageGallery(newImages);
  }catch(e){
    alert('‚ùå Upload th·∫•t b·∫°i: ' + e.message);
  }
}

function getCurrentImages(){
  return Array.from($('#imageGallery .image-item')).map(item => 
    item.querySelector('img').src
  );
}

function renderImageGallery(images){
  const gallery = $('#imageGallery');
  gallery.innerHTML = images.map((src, index) => `
    <div class="image-item">
      <img src="${src}" alt="Product ${index + 1}">
      <button class="image-remove" onclick="removeImage(${index})">√ó</button>
    </div>
  `).join('');
}

function removeImage(index){
  const images = getCurrentImages();
  images.splice(index, 1);
  renderImageGallery(images);
}

// Form Submission
$('#productForm').onsubmit = async (e) => {
  e.preventDefault();
  
  const formData = {
    name: $('#edit_name').value.trim(),
    slug: $('#edit_slug').value.trim(),
    price: parseFloat($('#edit_price').value) || 0,
    original_price: parseFloat($('#edit_original_price').value) || null,
    category_id: parseInt($('#edit_category_id').value) || null,
    description: $('#edit_description').value.trim(),
    long_desc: $('#edit_long_desc').value.trim(),
    status: $('#edit_status').value,
    sort_order: parseInt($('#edit_sort_order').value) || 0,
    stock: parseInt($('#edit_stock').value) || null,
    images: getCurrentImages()
  };
  
  if(!formData.name || !formData.slug){
    return alert('‚ùå Vui l√≤ng nh·∫≠p t√™n v√† slug s·∫£n ph·∫©m');
  }
  
  try{
    const productId = $('#edit_id').value;
    if(productId){
      await api(`/products/${productId}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(formData)
      });
      alert('‚úÖ C·∫≠p nh·∫≠t s·∫£n ph·∫©m th√†nh c√¥ng!');
    } else {
      await api('/products', {
        method: 'POST', 
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(formData)
      });
      alert('‚úÖ Th√™m s·∫£n ph·∫©m m·ªõi th√†nh c√¥ng!');
    }
    
    closeModal();
    renderProducts();
  }catch(e){
    alert('‚ùå L·ªói: ' + e.message);
  }
};

async function deleteProduct(productId){
  if(!confirm('üóëÔ∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh√¥ng?\n\nH√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')){
    return;
  }
  
  try{
    await api(`/products/${productId}`, {method: 'DELETE'});
    alert('‚úÖ ƒê√£ x√≥a s·∫£n ph·∫©m th√†nh c√¥ng!');
    renderProducts();
  }catch(e){
    alert('‚ùå L·ªói x√≥a s·∫£n ph·∫©m: ' + e.message);
  }
}

// Categories Management  
async function renderCategories(){
  try{
    await loadCategories();
    
    $('#panel').innerHTML = `
      <div class="card">
        <h3>üè∑Ô∏è Th√™m danh m·ª•c m·ªõi</h3>
        <div class="row">
          <input id="cat_name" placeholder="T√™n danh m·ª•c" style="flex:2">
          <input id="cat_slug" placeholder="slug-url" style="flex:1">
          <button class="btn" id="cat_add">‚ûï Th√™m</button>
        </div>
      </div>
      
      <div class="card">
        <h3>üìã Danh s√°ch danh m·ª•c (${categories.length})</h3>
        <table>
          <thead>
            <tr><th>ID</th><th>T√™n</th><th>Slug</th><th>M√¥ t·∫£</th><th>Thao t√°c</th></tr>
          </thead>
          <tbody>
            ${categories.map(cat => `
              <tr>
                <td>${cat.id}</td>
                <td><input value="${cat.name}" data-id="${cat.id}" data-field="name" style="border:1px solid #ddd;padding:8px;border-radius:4px"></td>
                <td><code>${cat.slug}</code></td>
                <td><input value="${cat.description || ''}" data-id="${cat.id}" data-field="description" style="border:1px solid #ddd;padding:8px;border-radius:4px"></td>
                <td>
                  <div class="row" style="gap:8px">
                    <button class="btn-outline btn-sm" data-save="${cat.id}">üíæ L∆∞u</button>
                    <button class="btn-danger btn-sm" data-del-cat="${cat.id}">üóëÔ∏è</button>
                  </div>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>`;
    
    $('#cat_add').onclick = async ()=>{
      const name = $('#cat_name').value.trim();
      const slug = $('#cat_slug').value.trim();
      if(!name || !slug) return alert('‚ùå Nh·∫≠p ƒë·ªß t√™n v√† slug');
      
      try{
        await api('/categories', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({name, slug})
        });
        alert('‚úÖ Th√™m danh m·ª•c th√†nh c√¥ng!');
        renderCategories();
      }catch(e){
        alert('‚ùå ' + e.message);
      }
    };
    
    // Handle category save/delete
    $('#panel').addEventListener('click', async (e) => {
      const saveId = e.target.getAttribute('data-save');
      const delId = e.target.getAttribute('data-del-cat');
      
      if(saveId){
        const row = e.target.closest('tr');
        const name = row.querySelector('[data-field="name"]').value;
        const description = row.querySelector('[data-field="description"]').value;
        
        try{
          await api(`/categories/${saveId}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, description})
          });
          alert('‚úÖ C·∫≠p nh·∫≠t danh m·ª•c th√†nh c√¥ng!');
          await loadCategories();
        }catch(e){
          alert('‚ùå ' + e.message);
        }
      }
      
      if(delId && confirm('üóëÔ∏è X√≥a danh m·ª•c n√†y?')){
        try{
          await api(`/categories/${delId}`, {method: 'DELETE'});
          alert('‚úÖ ƒê√£ x√≥a danh m·ª•c!');
          renderCategories();
        }catch(e){
          alert('‚ùå ' + e.message);
        }
      }
    });
    
  }catch(e){
    $('#panel').innerHTML = `<div class="card"><p>‚ùå L·ªói: ${e.message}</p></div>`;
  }
}

// Upload Management
function renderUpload(){
  $('#panel').innerHTML = `
    <div class="card">
      <h3>üìÅ Upload h√¨nh ·∫£nh l·∫ª</h3>
      <p style="color:#6b7280;margin-bottom:16px">Upload ·∫£nh ƒë·ªÉ s·ª≠ d·ª•ng trong s·∫£n ph·∫©m ho·∫∑c n·ªôi dung kh√°c</p>
      
      <div class="drag-drop" id="bulkDrop">
        <div>K√©o th·∫£ nhi·ªÅu h√¨nh ·∫£nh v√†o ƒë√¢y ho·∫∑c <strong>click ƒë·ªÉ ch·ªçn</strong></div>
        <div style="font-size:12px;color:#6b7280;margin-top:8px">H·ªó tr·ª£: JPG, PNG, WebP. T·ªëi ƒëa 5MB/file.</div>
      </div>
      <input type="file" id="bulkInput" multiple accept="image/*" style="display:none">
      
      <div id="uploadResults" style="margin-top:20px"></div>
    </div>`;
  
  const dropZone = $('#bulkDrop');
  const fileInput = $('#bulkInput');
  
  dropZone.onclick = () => fileInput.click();
  
  dropZone.ondragover = (e) => {
    e.preventDefault();
    dropZone.classList.add('dragover');
  };
  
  dropZone.ondragleave = () => dropZone.classList.remove('dragover');
  
  dropZone.ondrop = (e) => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    handleBulkUpload(e.dataTransfer.files);
  };
  
  fileInput.onchange = (e) => handleBulkUpload(e.target.files);
}

async function handleBulkUpload(files){
  const results = $('#uploadResults');
  results.innerHTML = '<p>üì§ ƒêang upload...</p>';
  
  const formData = new FormData();
  for(const file of files){
    formData.append('files', file);
  }
  
  try{
    const result = await api('/upload', {method: 'POST', body: formData});
    results.innerHTML = `
      <h4>‚úÖ Upload th√†nh c√¥ng ${result.files.length} file(s):</h4>
      <div class="image-gallery">
        ${result.files.map(f => `
          <div class="card" style="padding:12px;text-align:center">
            <img src="${f.url}" style="width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:8px">
            <div style="font-size:12px;word-break:break-all">
              <input value="${f.url}" readonly style="width:100%;font-size:11px;padding:4px" onclick="this.select()">
            </div>
          </div>
        `).join('')}
      </div>`;
  }catch(e){
    results.innerHTML = `<p style="color:#dc2626">‚ùå Upload th·∫•t b·∫°i: ${e.message}</p>`;
  }
}

// Initialize
const app = $('#app');
viewDashboard();

</script>
</body>
</html>
